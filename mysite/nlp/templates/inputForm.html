{% load static %}
<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<!-- import CSS -->
	<title>简单的自然语言处理</title>
	<link rel="stylesheet" href="https://cdn.bootcss.com/element-ui/2.12.0/theme-chalk/index.css">
</head>

<body>
	<div id="app" style="width: 800px;height: 600px;text-align:center;margin: 0 auto;">
		<el-container>
			<el-main>
				<el-tabs type="border-card">
                    <!-- 第一个标签页 -->
					<el-tab-pane label="输入文本">
						<el-row type="flex" class="row-bg">
							<el-input type="textarea" :rows="10" placeholder="请输入内容" v-model="textarea" name="sentence">
							</el-input>
						</el-row>
						<el-row type="flex" justify="start">
							<el-col :span="1">
								<el-tooltip class="item" effect="dark" content="随机示例" placement="bottom-start">
									<el-button type="info" icon="el-icon-refresh" id="random" @click="randomSample" plain>随机示例</el-button>
								</el-tooltip>
							</el-col>
							<el-col :span="8" :offset="7">
								<el-button type="primary" icon="el-icon-s-promotion" name="submit" @click="onSubmit" plain>分析</el-button>
							</el-col>
						</el-row>
                    </el-tab-pane>
                    <!-- 第二个标签页 -->
					<el-tab-pane label="上传文本">
						<el-row type="flex" class="row-bg">
							<el-col :span="6">
								<div class="grid-content bg-purple"></div>
							</el-col>
							<el-col :span="6">
								<div class="grid-content bg-purple-light">
									<el-upload class="upload-demo" drag action="/UploadFile/" multiple name="TxtFile" accept=".txt" :on-success="uploadSuccess"
									 :on-error="uploadError">
										<i class="el-icon-upload"></i>
                                        <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
                                        <div class="el-upload__tip">只能上传txt文件，且不超过500kb</div>
                                    </el-upload>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="grid-content bg-purple"></div>
                            </el-col>
                        </el-row>
                    </el-tab-pane>

                    <el-row type="flex" class="row-bg" justify="center">
                        <el-col :span="8">
                            <div></div>
                        </el-col>
                        <el-col :span="8">
                            <el-rate
                                v-model="value"
                                disabled
                                show-score
                                :colors="colors"
                                text-color="#ff9900"
                                score-template="{value}">
                            </el-rate>
                        </el-col>
                        <el-col :span="0"></el-col>
                        <el-col :span="8"></el-col>
                    </el-row>
		  <el-row>
		  <!-- 词云图 -->
		      <!-- <div id="cloudImg"></div> -->
		  </el-row>
            </el-tabs>
            
        </el-main>


    </el-container>
    <!-- 右下角的一个2D人物 -->
    <!-- <div id="page_end_html"><script src="https://cdn.jsdelivr.net/npm/live2d-widget@3.0.4/lib/L2Dwidget.min.js"></script> <script type="text/javascript"> L2Dwidget.init(); </script></div> -->
</div>

</body>
<!-- import Vue before Element -->
<script src="https://cdn.bootcss.com/vue/2.6.9/vue.min.js"></script>
<!-- import JavaScript -->
<script src="https://cdn.bootcss.com/element-ui/2.12.0/index.js"></script>
<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
<!-- <script src="./static/d3.js"></script> -->
<!-- <script src="./static/build/d3.layout.cloud.js"></script> -->
<script>
    var i = -1;
    ls = new Array;
    var arr = [0, 1, 2, 3, 4, 5 ,6];
    function randomsort(a, b) {
        return Math.random()>.5 ? -1 : 1;
    }
    arr.sort(randomsort);//随机打乱
    sample = new Array;
    sample[0] = "我是计算机专业的学生"
    sample[1] = "小明喜欢打篮球"
    sample[2] = "巨大的噪声吵醒了熟睡的我"
    sample[3] = "巨大的噪声吵醒了熟睡的我"
    sample[4] = "巨大的噪声吵醒了熟睡的我"
    sample[5] = "巨大的噪声吵醒了熟睡的我"
    sample[6] = "巨大的噪声吵醒了熟睡的我"

    new Vue({
        el: '#app',
        data: function () {
            return {
                visible: false,
                textarea:'',
                value:0,
                url:"https://ftp.bmp.ovh/imgs/2019/10/21f9a00cab7d11a0.png",
                colors: ['#99A9BF', '#F7BA2A', '#FF9900'],
            }
        },
        methods:{
            onSubmit(){
                if (this.textarea == "") {
                    this.$message.error('分析内容不能为空');
                } else if (this.textarea.length <= 3) {
                    this.$message.error('分析内容过短');
                } else {
                    var params = new URLSearchParams();
                    params.append('sentence', this.textarea);
                    axios.post("/UploadText/",params).then((response)=>{
                    console.log('上传文本', response)
                    
                    // this.value=response.data['Star'];
                    // ls = response.data['Tags'].reverse();
                    // doit();
                    this.$message({type: 'success',message: '分析成功!'});
                    });
                }
            },
            uploadSuccess (response, file, fileList) {
                console.log('上传文件', response)
                this.value=response['Star'];
                ls = response['Tags'].reverse();
                // doit();
                this.$message({type: 'success',message: '分析成功!'});
            },
            uploadError (response, file, fileList) {
                this.$alert('请检查上传txt文件是否为UTF-8编码', '上传失败',{
                  confirmButtonText: '确定',
                  type: 'error',
                  center: true
                })
                console.log('上传文件', response);
            },
            
            randomSample(){
                var t=document.getElementById("txt");
                i = (i + 1) % 7;
                x = arr[i];
                this.textarea = sample[x]
                switch(x) {
                    case 0:
                        this.$message('此评价来自华为 Mate30，评价星级为 5 星');
                        break;
                    case 1:
                        this.$message('此评价来自十字勋章 双肩包，评价星级为 3 星');
                        break;
                    case 2:
                        this.$message('此评价来自巧谷 女式外套，评价星级为 5 星');
                        break;
                    case 3:
                        this.$message('此评价来自西门子 冰箱，评价星级为 1 星');
                        break;
                    case 4:
                        this.$message('此评价来自三星 星耀7 笔记本，评价星级为 1 星');
                        break;
                    case 5:
                        this.$message('此评价来自三星 星耀pen 翻转本，评价星级为 1 星');
                        break;
                    case 6:
                        this.$message('此评价来自《创业者：不一样的孙陶然》，评价星级为 5 星');
                        break;
                }
            }
        }
    })
    doit=function(){
            document.getElementById('cloudImg').innerHTML = "";//删除之前的图
            if (ls.length<10){
		    document.getElementById('cloudImg').innerHTML="<img src='{%static "nlp/image/noCloud.jpg" %}'><p>字数不够，词云藏起来了！</p>";
                return;
            }
            var fill = d3.scale.category20();
            
            var layout = d3.layout.cloud()
                .size([500, 500])
                .words(ls.map(function(d,index) {
                  return {text: d, size: 30 + index * 4};
                }))
                .padding(5)
                .rotate(function() { return ~~(Math.random() * 2) * 90; })
                .font("Impact")
                .fontSize(function(d) { return d.size; })
                .on("end", draw);
            
            layout.start();
            
            function draw(words) {
              d3.select("#cloudImg").append("svg")
                  .attr("width", layout.size()[0])
                  .attr("height", layout.size()[1])
                .append("g")
                  .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                .selectAll("text")
                  .data(words)
                .enter().append("text")
                  .style("font-size", function(d) { return d.size + "px"; })
                  .style("font-family", "Impact")
                  .style("fill", function(d, i) { return fill(i); })
                  .attr("text-anchor", "middle")
                  .attr("transform", function(d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                  })
                  .text(function(d) { return d.text; });
            }
            
        };
</script>
<style>
    .el-row {
        margin-bottom: 20px;
    }

    .el-col {
        border-radius: 4px;
    }

    .el-tabs {
        background-image:url(https://s2.ax1x.com/2019/10/06/u62vOs.png);
        background-size:120px 130px;
        background-repeat:no-repeat;
        background-position:bottom right
    }
</style>
</html>
